var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,s=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,l=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(e,o)=>{for(var n in o||(o={}))t.call(o,n)&&l(e,n,o[n]);if(s)for(var n of s(o))a.call(o,n)&&l(e,n,o[n]);return e};import{r as n,o as r,a as i,d as c,w as u,c as m,b as d,e as p,t as g,f as v,g as f,F as b,h,i as y,u as w,j as C,k,l as L,m as x,n as V,p as F,q as R,s as A,v as $,x as j,y as U,z as D,A as M,B as _,C as I,D as O,E,G as P,H as z,I as B}from"./vendor.49cf7189.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const a=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,o)=>{const n=new URL(e,a);if(self[t].moduleMap[n])return s(self[t].moduleMap[n]);const r=new Blob([`import * as m from '${n}';`,`${t}.moduleMap['${n}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){o(new Error(`Failed to import: ${e}`)),l(i)},onload(){s(self[t].moduleMap[n]),l(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("assets/");var S=c({props:{user:{type:Object,required:!0}},setup(){const e=n(!1),t=n(null),s=(e=>{const t=n(!0),s=s=>{if(e.value){const a=s.target;t.value=!e.value.contains(a)}};return r((()=>{document.addEventListener("click",s)})),i((()=>{document.removeEventListener("click",s)})),t})(t);u(s,(()=>{s.value&&e.value&&(e.value=!1)}));return{isOpen:e,dropdownRef:t,openTrigger:()=>{e.value=!e.value}}}});const q={class:"dropdown",ref:"dropdownRef"},H={key:0,class:"dropdown-menu",style:{display:"block"}};S.render=function(e,t,s,a,l,o){return h(),m(b,null,[d("div",q,[d("button",{class:"btn btn-outline-light dropdown-toggle",onClick:t[1]||(t[1]=p(((...t)=>e.openTrigger&&e.openTrigger(...t)),["prevent"]))}," 欢迎 "+g(e.user.nickName),1)],512),e.isOpen?(h(),m("ul",H,[v(e.$slots,"default")])):f("",!0)],64)};var T=c({props:{disabled:{type:Boolean,default:!1}},setup(){}});const Z={class:"dropdown-option"};T.render=function(e,t,s,a,l,o){return h(),m("li",Z,[d("a",{class:["dropdown-item",{disabled:e.disabled}],href:"#"},[v(e.$slots,"default")],2)])};var N=c({name:"Header",components:{DropdownList:S,DropdownItem:T},setup(){const e=w(),t=C();return{userInfo:y((()=>t.state.user)),userLogin:()=>{e.push("/login")}}}});const G={class:"navbar navbar-dark bg-primary justify-content-between mb-4 px-4"},J=x("者也专栏"),K={key:0,class:"list-inline mb-0"},Q={class:"list-inline-item"},W=d("li",{class:"list-inline-item"},[d("a",{class:"btn btn-outline-light"},"注册")],-1),X={key:1,class:"list-inline mb-0"},Y={class:"list-inline-item"},ee=x("新建文章"),te=x("我的专栏"),se=x("退出登录");N.render=function(e,t,s,a,l,o){const n=k("router-link"),r=k("DropdownItem"),i=k("DropdownList");return h(),m("nav",G,[d(n,{to:"/",class:"navbar-brand"},{default:L((()=>[J])),_:1}),e.userInfo.isLogin?(h(),m("ul",X,[d("li",Y,[d(i,{user:e.userInfo},{default:L((()=>[d(r,null,{default:L((()=>[ee])),_:1}),d(r,{disabled:!0},{default:L((()=>[te])),_:1}),d(r,null,{default:L((()=>[se])),_:1})])),_:1},8,["user"])])])):(h(),m("ul",K,[d("li",Q,[d("a",{class:"btn btn-outline-light",onClick:t[1]||(t[1]=(...t)=>e.userLogin&&e.userLogin(...t))},"登录")]),W]))])};const ae={},le={class:"py-4 bg-light text-center text-secondary mt-6"},oe=V('<small><ul class="list-inline mb-0"><li class="list-inline-item">@ 2020 者也专栏</li><li class="list-inline-item">课程</li><li class="list-inline-item">文档</li><li class="list-inline-item">联系</li><li class="list-inline-item">更多</li></ul></small>',1);ae.render=function(e,t){return h(),m("footer",le,[oe])};var ne=c({name:"App",components:{Header:N,Footer:ae},setup(){}});const re={class:"container"};ne.render=function(e,t,s,a,l,o){const n=k("Header"),r=k("router-view"),i=k("Footer");return h(),m("div",re,[d(n),d(r),d(i)])};var ie=c({setup(){const e=C(),t=y((()=>e.state.columns.list)),s=y((()=>t.value&&t.value.map((e=>(e.avatar&&!e.avatar.url&&(e.avatar=o(o({},e.avatar),{url:"/src/assets/DefaultIcon.jpg"})),e)))));return r((()=>{e.dispatch("fetchColumns")})),{columnsList:s}}});const ce=R();A("data-v-26c027ec");const ue={class:"row"},me={class:"card h-100 shadow-sm"},de={class:"card-body text-center"},pe={class:"card-title"},ge={class:"card-text text-start mx-4"},ve=d("button",{class:"btn btn-outline-primary"},"进入专栏",-1);$();const fe=ce(((e,t,s,a,l,o)=>(h(),m("div",ue,[(h(!0),m(b,null,F(e.columnsList,(e=>(h(),m("div",{key:e,class:"col-4 mb-4"},[d("div",me,[d("div",de,[d("img",{src:e.avatar.url,class:"rounded-circle border border-light my-3"},null,8,["src"]),d("h5",pe,g(e.title),1),d("p",ge,g(e.description),1),ve])])])))),128))]))));ie.render=fe,ie.__scopeId="data-v-26c027ec";var be=c({name:"Home",setup(){const e=C();return{getMoreColumns:()=>{e.commit("getMoreColumns"),e.dispatch("fetchColumns")},isEnd:y((()=>e.state.columns.isEnd))}},components:{ColumnList:ie}});const he={class:"home-page"},ye=d("section",{class:"py-5 text-center container"},[d("div",{class:"row py-lg-5"},[d("div",{class:"col-lg-6 col-md-8 mx-auto"},[d("img",{src:"./assets/callout.e640eb6c.svg",alt:"callout",class:"w-50"}),d("h2",{class:"font-weight-light"},"随心写作，自由表达"),d("p",null,[d("a",{href:"#",class:"btn btn-primary my-2"},"开始写文章")])])])],-1),we=d("h4",{class:"font-weight-bold text-center"},"发现精彩",-1),Ce={class:"d-grid col-6 mx-auto"},ke={key:1,class:"mx-auto w-25 text-center",style:{color:"gray"}};be.render=function(e,t,s,a,l,o){const n=k("ColumnList");return h(),m("div",he,[ye,we,d(n),d("div",Ce,[e.isEnd?(h(),m("span",ke,"到底啦")):(h(),m("button",{key:0,class:"btn btn-outline-primary mt-2 mb-5 mx-auto w-25",onClick:t[1]||(t[1]=(...t)=>e.getMoreColumns&&e.getMoreColumns(...t))}," 点击加载更多 "))])])};const Le=j();var xe=c({emits:["formCommit"],setup(e,t){let s=[];const a=e=>{s.push(e)};return Le.on("form-item-created",a),i((()=>{Le.off("form-item-created",a),s=[]})),{onFormCommit:()=>{const e=s.map((e=>e())).every((e=>e));t.emit("formCommit",e)}}}});xe.render=function(e,t,s,a,l,o){return h(),m("div",null,[v(e.$slots,"default"),v(e.$slots,"defaultBtn",{},(()=>[d("button",{class:"btn btn-outline-primary w-50 mx-auto",style:{height:"40px"},onClick:t[1]||(t[1]=(...t)=>e.onFormCommit&&e.onFormCommit(...t))}," 确定提交 ")]))])};const Ve={valid:{"is-valid":!0},invalid:{"is-invalid":!0}},Fe=/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;var Re=c({props:{rules:Array,tag:{type:String,default:"text"},label:{type:String,default:""}},inheritAttrs:!1,setup(e){const t=n(),s=n("参数错误"),a=U({value:"",error:null,errorMsg:"参数错误"}),l=()=>{if(e.rules){const t=e.rules.every((e=>{let t=!0;if(e.rule)switch(a.errorMsg=e.message,e.rule){case"required":t=""!==a.value.trim();break;case"email":""!==a.value&&(t=Fe.test(a.value));break;case"password":""!==a.value&&(t=a.value.length>=(e.min?e.min:6),t||(a.errorMsg=`密码不能少于${e.min?e.min:6}位`));break;case"custom":t=!e.func||e.func()}return t}));return a.error=t?Ve.valid:Ve.invalid,t}return!0};return r((()=>{Le.emit("form-item-created",l)})),{isValid:t,msg:s,validRef:a,loseFocus:l}}});const Ae={class:"col-md-10 mx-auto"},$e={key:0,class:"form-label"},je={class:"invalid-feedback"};Re.render=function(e,t,s,a,l,o){return h(),m("div",Ae,[e.label?(h(),m("label",$e,g(e.label),1)):f("",!0),"text"===e.tag?D((h(),m("input",_({key:1,class:["form-control",e.validRef.error]},e.$attrs,{"onUpdate:modelValue":t[1]||(t[1]=t=>e.validRef.value=t),onBlur:t[2]||(t[2]=(...t)=>e.loseFocus&&e.loseFocus(...t))}),null,16)),[[M,e.validRef.value]]):D((h(),m("textarea",_({key:2,class:["form-control",e.validRef.error]},e.$attrs,{"onUpdate:modelValue":t[3]||(t[3]=t=>e.validRef.value=t),onBlur:t[4]||(t[4]=(...t)=>e.loseFocus&&e.loseFocus(...t))}),null,16)),[[I,e.validRef.value]]),d("div",je,g(e.validRef.errorMsg),1)])};var Ue=c({name:"Login",setup(){const e=C(),t=n(""),s=n("");return{onFormCommit:a=>{if(a){const a={method:"post",data:{email:t.value,password:s.value}};e.dispatch("loginAndFetch",a).then((()=>{console.log(e.state.user)}))}},mailValidRule:[{rule:"email",message:"请输入有效的邮箱地址"},{rule:"required",message:"邮箱地址不能为空"}],pwdValidRule:[{rule:"password",min:6},{rule:"required",message:"密码不能为空"}],emailVal:t,pwdVal:s}},components:{ValidInput:Re,ValidForm:xe}});const De={class:"container"},Me={class:"row"},_e=d("div",{class:"col-6"},[d("img",{src:"./assets/loginLogo.4b2a2911.png",class:"h-120"})],-1);Ue.render=function(e,t,s,a,l,o){const n=k("ValidInput"),r=k("ValidForm");return h(),m("div",De,[d("div",Me,[_e,d(r,{class:"h-120 shadow-sm card col-6 py-5 mb-4 d-grid gap-4",onFormCommit:e.onFormCommit},{defaultBtn:L((()=>[])),default:L((()=>[d(n,{rules:e.mailValidRule,placeholder:"请输入邮箱",label:"邮箱地址：",modelValue:e.emailVal,"onUpdate:modelValue":t[1]||(t[1]=t=>e.emailVal=t)},null,8,["rules","modelValue"]),d(n,{rules:e.pwdValidRule,placeholder:"请输入密码",type:"password",label:"密码：",modelValue:e.pwdVal,"onUpdate:modelValue":t[2]||(t[2]=t=>e.pwdVal=t)},null,8,["rules","modelValue"])])),_:1},8,["onFormCommit"])])])};const Ie=[{path:"/",name:"Home",component:be},{path:"/login",name:"Login",component:Ue}],Oe=O({history:E(),routes:Ie}),Ee=P.create({baseURL:"https://apis.imooc.com/api/",timeout:2e4});Ee.interceptors.request.use((e=>("post"===e.method?e.data instanceof FormData?e.data.append("icode","0370D0ADAC459408"):e.data=o(o({},e.data),{icode:"0370D0ADAC459408"}):e.params=o(o({},e.params),{icode:"0370D0ADAC459408"}),e)),(e=>(console.log("error"),Promise.reject(e)))),Ee.interceptors.response.use((e=>e),(e=>Promise.reject(e)));const Pe=async(e,t,s,a={method:"get"},l)=>{const{data:o}=await Ee(t,a);return s(e,l?{data:o,extraData:l}:o),o},ze={user:{isLogin:!1,nickName:"某某某某",_id:""},columns:{pageSize:3,currentPage:1,list:[],isEnd:!1},token:""},Be=z({state:()=>ze,mutations:{userLogin(e,t){const{token:s}=t.data;console.log(s),s&&(localStorage.setItem("token",s),e.token=localStorage.getItem("token"),Ee.defaults.headers.common.Authorization=`Bearer ${s}`)},fetchCurrentUser(e,t){const{data:s}=t;s&&(e.user=o(o({},s),{isLogin:!0}))},userLogout(e){e.user.isLogin=!1},getColumns(e,t){const{data:s}=t;e.columns.list?(e.columns.list=e.columns.list.concat(s.list),s.count&&e.columns.list.length>=s.count&&(e.columns.isEnd=!0)):e.columns.list=s.list},getMoreColumns(e){e.columns.currentPage+=1}},actions:{fetchColumns:({state:e,commit:t})=>Pe("getColumns",`/columns?currentPage=${e.columns.currentPage}&pageSize=${e.columns.pageSize}`,t),login:({commit:e},t)=>Pe("userLogin","/user/login",e,t),fetchCurrentUser:({commit:e})=>Pe("fetchCurrentUser","/user/current",e),loginAndFetch:({dispatch:e},t)=>e("login",t).then((()=>e("fetchCurrentUser")))},getters:{}}),Se=B(ne);Se.use(Oe),Se.use(Be),Se.mount("#app");
